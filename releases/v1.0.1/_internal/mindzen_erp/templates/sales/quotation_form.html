{% extends "base.html" %}

{% block content %}
<!-- Top Navigation -->
<div class="top-nav">
    <div class="breadcrumb">
        <span class="text-gray-500">Sales</span> / <a href="/sales/quotations"
            class="text-gray-500 hover:text-gray-700">Quotations</a> / <span class="text-gray-800">{{ order.name if
            order else "New" }}</span>
    </div>
    <div class="user-menu">
        <img src="https://ui-avatars.com/api/?name=Admin" class="w-8 h-8 rounded-full">
    </div>
</div>

<!-- Control Panel -->
<div class="control-panel action-bar">
    <div class="buttons flex space-x-2">
        {% if not order or order.state == 'draft' %}
        <button type="submit" form="orderForm" class="btn-primary">Save</button>
        <form action="/sales/quotations/{{ order.id }}/confirm" method="POST" class="inline">
            <button type="submit" class="btn-primary bg-purple-800 hover:bg-purple-900">Confirm Order</button>
        </form>
        {% endif %}
        <a href="/sales/quotations"
            class="btn-secondary ml-2 text-sm text-gray-600 hover:text-gray-800 py-2">Discard</a>
    </div>

    {% if order %}
    <div class="statusbar ml-auto flex rounded bg-white border">
        {% for step in ['draft', 'sent', 'sale', 'done', 'cancel'] %}
        <div class="px-3 py-1 text-xs uppercase font-bold border-l first:border-l-0 
            {% if order.state == step %}bg-teal-600 text-white{% else %}bg-gray-50 text-gray-400{% endif %}">
            {{ step }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- Form View -->
<div class="p-6 max-w-5xl mx-auto">
    <div class="bg-white shadow-sm rounded border p-8">
        <form id="orderForm" action="{{ '/sales/quotations' if not order else '/sales/quotations/' + order.id|string }}"
            method="POST">

            <!-- Header -->
            <div class="mb-8 flex justify-between">
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-1">Customer</label>
                    <input type="text" name="customer_name" value="{{ order.customer_name if order else '' }}" required
                        class="text-2xl border-b-2 border-gray-300 focus:border-purple-600 outline-none w-full placeholder-gray-300"
                        placeholder="Customer Name">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-1">Date</label>
                    <span class="text-xl text-gray-800">{{ order.date_order.strftime('%Y-%m-%d') if order and
                        order.date_order else 'New' }}</span>
                </div>
            </div>

            <!-- Order Lines -->
            <div class="mt-8">
                <h3 class="text-lg font-medium text-gray-700 mb-4 border-b pb-2">Order Lines</h3>

                <table class="w-full text-left">
                    <thead>
                        <tr class="text-gray-500 text-sm border-b">
                            <th class="pb-2 font-medium w-1/2">Product</th>
                            <th class="pb-2 font-medium w-24">Quantity</th>
                            <th class="pb-2 font-medium w-32">Unit Price</th>
                            <th class="pb-2 font-medium w-32 text-right">Subtotal</th>
                            <th class="pb-2 w-10"></th>
                        </tr>
                    </thead>
                    <tbody id="line-container">
                        {% if order and order.lines %}
                        {% for line in order.lines %}
                        <tr class="border-b border-gray-100">
                            <td class="py-2">{{ line.product_name }}</td>
                            <td class="py-2">{{ line.quantity }}</td>
                            <td class="py-2">${{ line.price_unit }}</td>
                            <td class="py-2 text-right">${{ line.subtotal }}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <!-- Placeholder empty line for new orders -->
                        <tr class="border-b border-gray-100 group">
                            <td class="py-2"><input type="text" class="w-full outline-none"
                                    placeholder="Add a product..."></td>
                            <td class="py-2"><input type="number" class="w-full outline-none" value="1"></td>
                            <td class="py-2"><input type="number" class="w-full outline-none" value="0.00"></td>
                            <td class="py-2 text-right">$0.00</td>
                            <td class="py-2 text-gray-300 hover:text-red-500 cursor-pointer"><i class="fa fa-trash"></i>
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>

                <div class="mt-4">
                    <button type="button" class="text-purple-600 hover:text-purple-800 text-sm font-medium">Add a
                        product</button>
                </div>
            </div>

            <!-- Totals -->
            <div class="flex justify-end mt-8">
                <div class="w-64 space-y-2">
                    <div class="flex justify-between text-gray-600">
                        <span>Untaxed Amount:</span>
                        <span>${{ order.amount_total if order else '0.00' }}</span>
                    </div>
                    <div class="flex justify-between text-gray-600">
                        <span>Taxes:</span>
                        <span>$0.00</span>
                    </div>
                    <div class="flex justify-between text-xl font-bold text-gray-800 border-t pt-2 mt-2">
                        <span>Total:</span>
                        <span>${{ order.amount_total if order else '0.00' }}</span>
                    </div>
                </div>
            </div>

        </form>
    </div>
</div>
{% endblock %}