{% extends "base.html" %}

{% block content %}
<!-- Top Navigation -->
<div class="top-nav">
    <div class="breadcrumb">
        <span class="text-gray-500">CRM</span> / <a href="/crm/leads"
            class="text-gray-500 hover:text-gray-700">Leads</a> / <span class="text-gray-800">{{ "New" if not lead else
            lead.name }}</span>
    </div>
    <div class="user-menu">
        <img src="https://ui-avatars.com/api/?name=Admin" class="w-8 h-8 rounded-full">
    </div>
</div>

<!-- Control Panel -->
<div class="control-panel action-bar">
    <div class="buttons">
        <button type="submit" form="leadForm" class="btn-primary">Save</button>
        <a href="/crm/leads" class="btn-secondary ml-2 text-sm text-gray-600 hover:text-gray-800">Discard</a>
    </div>

    {% if lead %}
    <div class="flex space-x-2">
        {% if lead.status == 'new' %}
        <form action="/crm/leads/{{ lead.id }}/status" method="POST" class="inline">
            <input type="hidden" name="status" value="contacted">
            <button type="submit" class="text-xs uppercase font-bold text-gray-500 hover:text-purple-700">Mark
                Contacted</button>
        </form>
        {% endif %}
        {% if lead.status == 'contacted' %}
        <form action="/crm/leads/{{ lead.id }}/convert" method="POST" class="inline">
            <button type="submit" class="text-xs uppercase font-bold text-gray-500 hover:text-green-700">Convert to
                Opportunity</button>
        </form>
        {% endif %}
    </div>

    <div class="statusbar ml-auto flex rounded bg-white border">
        {% for step in ['new', 'contacted', 'qualified', 'lost'] %}
        <div class="px-3 py-1 text-xs uppercase font-bold border-l first:border-l-0 
            {% if lead.status == step %}bg-teal-600 text-white{% else %}bg-gray-50 text-gray-400{% endif %}">
            {{ step }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<!-- Form View -->
<div class="p-6 max-w-5xl mx-auto">
    <div class="bg-white shadow-sm rounded border p-8">
        <form id="leadForm" action="{{ '/crm/leads/' + lead.id|string if lead else '/crm/leads' }}" method="POST">

            <!-- Header/Name -->
            <div class="mb-8">
                <label class="block text-sm font-bold text-purple-900 mb-1">Lead Name</label>
                <input type="text" name="name" value="{{ lead.name if lead else '' }}" required
                    class="text-3xl border-b-2 border-gray-300 focus:border-purple-600 outline-none w-1/2 placeholder-gray-300"
                    placeholder="e.g. John Doe">
            </div>

            <div class="grid grid-cols-2 gap-12">
                <!-- Left Column -->
                <div class="space-y-4">
                    <div class="form-group flex items-center">
                        <label class="w-1/3 text-sm font-bold text-gray-600">Email</label>
                        <input type="email" name="email" value="{{ lead.email if lead else '' }}"
                            class="w-2/3 border-b border-gray-300 focus:border-purple-600 outline-none py-1">
                    </div>

                    <div class="form-group flex items-center">
                        <label class="w-1/3 text-sm font-bold text-gray-600">Phone</label>
                        <input type="text" name="phone" value="{{ lead.phone if lead else '' }}"
                            class="w-2/3 border-b border-gray-300 focus:border-purple-600 outline-none py-1">
                    </div>

                    <div class="form-group flex items-center">
                        <label class="w-1/3 text-sm font-bold text-gray-600">Company</label>
                        <input type="text" name="company" value="{{ lead.company if lead else '' }}"
                            class="w-2/3 border-b border-gray-300 focus:border-purple-600 outline-none py-1">
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-4">
                    <div class="form-group flex items-center">
                        <label class="w-1/3 text-sm font-bold text-gray-600">Expected Revenue</label>
                        <div class="w-2/3 flex items-center border-b border-gray-300 focus-within:border-purple-600">
                            <span class="text-gray-500 mr-2">$</span>
                            <input type="number" step="0.01" name="expected_revenue"
                                value="{{ lead.expected_revenue if lead else '0.00' }}"
                                class="w-full outline-none py-1">
                        </div>
                    </div>

                    <div class="form-group flex items-center">
                        <label class="w-1/3 text-sm font-bold text-gray-600">Priority</label>
                        <select name="priority"
                            class="w-2/3 border-b border-gray-300 focus:border-purple-600 outline-none py-1 bg-transparent">
                            <option value="low" {% if lead and lead.priority=='low' %}selected{% endif %}>Low</option>
                            <option value="medium" {% if lead and lead.priority=='medium' %}selected{% endif %}>Medium
                            </option>
                            <option value="high" {% if lead and lead.priority=='high' %}selected{% endif %}>High
                            </option>
                        </select>
                    </div>

                    <div class="form-group flex items-center">
                        <label class="w-1/3 text-sm font-bold text-gray-600">Source</label>
                        <select name="source"
                            class="w-2/3 border-b border-gray-300 focus:border-purple-600 outline-none py-1 bg-transparent">
                            <option value="website" {% if lead and lead.source=='website' %}selected{% endif %}>Website
                            </option>
                            <option value="referral" {% if lead and lead.source=='referral' %}selected{% endif %}>
                                Referral</option>
                            <option value="campaign" {% if lead and lead.source=='campaign' %}selected{% endif %}>
                                Marketing Campaign</option>
                            <option value="direct" {% if lead and lead.source=='direct' %}selected{% endif %}>Direct
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="mt-8 border-b">
                <nav class="-mb-px flex space-x-8">
                    <a href="#"
                        class="border-purple-500 text-purple-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Internal Notes
                    </a>
                    <a href="#"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Extra Info
                    </a>
                </nav>
            </div>

            <div class="mt-4">
                <textarea name="notes" rows="4" placeholder="Add notes..."
                    class="w-full border p-2 rounded text-sm focus:border-purple-500 outline-none">{{ lead.notes if lead else '' }}</textarea>
            </div>

        </form>
    </div>
</div>
{% endblock %}